(window.webpackJsonp=window.webpackJsonp||[]).push([[31],{424:function(t,s,a){"use strict";a.r(s);var n=a(27),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"_12장-파드-스케줄링"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_12장-파드-스케줄링"}},[t._v("#")]),t._v(" 12장 파드 스케줄링")]),t._v(" "),a("ABG"),t._v(" "),a("br"),t._v(" "),a("h2",{attrs:{id:"파드-스케줄링"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#파드-스케줄링"}},[t._v("#")]),t._v(" 파드 스케줄링")]),t._v(" "),a("ul",[a("li",[t._v("특정 파드들을 노드 하나에 모아두거나 특정 IP 대역의 노드들에서만 실행")]),t._v(" "),a("li",[t._v("같은 기능이 있는 파드들이 노드 하나에 몰려있지 않도록 분산 실행")]),t._v(" "),a("li",[t._v("관리가 필요한 노드가 있을때 해당 노드에 있는 파드들을 다른 노드로 이동")])]),t._v(" "),a("br"),t._v(" "),a("h2",{attrs:{id:"노드셀렉터"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#노드셀렉터"}},[t._v("#")]),t._v(" 노드셀렉터")]),t._v(" "),a("ul",[a("li",[t._v("가장 간단한 스케줄링 옵션을 "),a("code",[t._v(".spec")]),t._v(" 필드에 설정 가능한 노드셀렉터가 있음")]),t._v(" "),a("li",[t._v("파드가 클러스터 안 어떤 노드에서 실행될지를 키-값 쌍으로 설정")]),t._v(" "),a("li",[t._v("노드셀렉터는 노드의 레이블에 설정된 값으로 노드를 선택")])]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Pod\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kubernetes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("nodeselector"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("pod\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("containers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kubernetes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("nodeselector"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("pod\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" arisu1000/simple"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("container"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("latest\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("containerPort")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8080")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("nodeSelector")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("disktype")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ssd  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# disktype이 ssd인 노드에 실행 가능")]),t._v("\n")])])]),a("br"),t._v(" "),a("h2",{attrs:{id:"어피니티와-안티-어피니티"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#어피니티와-안티-어피니티"}},[t._v("#")]),t._v(" 어피니티와 안티 어피니티")]),t._v(" "),a("ul",[a("li",[t._v("파드들을 함께 묶어서 같은 노드에서 실행하도록 설정하는 어피니티와 파드들을 다른 노드에 나누어서 실행하도록 설정하는 안티 어피니티")])]),t._v(" "),a("h3",{attrs:{id:"노드-어피니티-node-affinity"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#노드-어피니티-node-affinity"}},[t._v("#")]),t._v(" 노드 어피니티(Node affinity)")]),t._v(" "),a("ul",[a("li",[t._v("노드 어피니티는 노드셀렉터와 비슷하게 노드의 레이블 기반으로 파드를 스케줄링")]),t._v(" "),a("li",[t._v("노드 어피니티와 노드셀렉터를 함께 설정할 수 있으며 이때는 노드 어피니티와 노드셀렉터의 조건을 모두. 만족하는 노드에 파드를 스케줄링")]),t._v(" "),a("li",[a("code",[t._v("requiredDuringSchedulingIgnoredDuringExecution")]),t._v(","),a("code",[t._v("preferredDuringSchedulingIgnoredDuringExecution")]),t._v(" 두 필드는 실행 중에 조건이 바뀌어도 무시; 파드가 이미 스케줄링되어 특정 노드에서 실행 중이라면 중간에 해당 노드의 조건이 변경되더라도 이미 실행 중인 파드는 그대로 실행된다는 뜻")])]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Pod\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kubernetes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("nodeaffinity"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("pod\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("containers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kubernetes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("nodeaffinity"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("pod\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" arisu1000/simple"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("container"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("latest\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("containerPort")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8080")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("affinity")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 어피니티 설정")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("nodeAffinity")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 노드 어피니티")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("requiredDuringSchedulingIgnoredDuringExecution")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 스케줄링하는 동안 꼭 필요한 조건")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("nodeSelectorTerms")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 노드 어피니티 유형")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("matchExpressions")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 연관된 노드셀렉터 설정을 연결하는 필드")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("key")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" beta.kubernetes.io/os "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 노드의 레이블 키 중 하나를 설정")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("operator")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" In "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 키가 만족할 조건 ")]),t._v("\n\t            "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# In: .values[] 필드에 설정한 값 중 레입ㄹ에 있는 값과 일치하는 것이 하나라도 있는지 확인")]),t._v("\n\t            "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# NotIn: In과 반대로 .values[] 필드에 있는 값 모두와 맞지 않는지 확인")]),t._v("\n\t            "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Exists: .values[] 필드가 필요 없고 .key 필드에 설정한 값이 레이블에 있는지만 확인")]),t._v("\n\t            "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# DoesNotExist: Exists와 반대")]),t._v("\n\t            "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Gt: Greater than으로 .values[] 필드에 설정된 값보다 큰 숫자형 데이터인지를 확인. values에 값이 하나만 있어야함")]),t._v("\n\t            "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Lt: Lower than으로 Gt와 반대")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("values")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" linux\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" window\n          "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("key")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" disktype\n            "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("operator")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Exists\n          "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# - key: core")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# operator: Gt")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# values:")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# - "4"')]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("preferredDuringSchedulingIgnoredDuringExecution")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 필수는 아니지만 스케줄링하는 동안 만족하면 좋은 조건")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("weight")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 1부터 100까지의 값 설정 가능; 노드의 설정이 맞을 때 마다 .weight 필드 값을 더하고, .weight 합산이 가장 큰 노드를 선택")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("preference")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 해당 조건에 맞는 걸 선호")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("matchExpressions")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("key")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kubernetes.io/hostname\n            "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("operator")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" In\n            "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("values")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" worker"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("node01\n")])])]),a("h3",{attrs:{id:"파드의-어피니티와-안티-어피니티"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#파드의-어피니티와-안티-어피니티"}},[t._v("#")]),t._v(" 파드의 어피니티와 안티 어피니티")]),t._v(" "),a("ul",[a("li",[t._v("파드 사이의 어피니티와 안티 어피니티는 디플로이먼트나 스테이트풀세트로 파드를 배포했을 때 개별 파드 사이의 관계를 정의하는 용도로 사용")])]),t._v(" "),a("h4",{attrs:{id:"어피니티"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#어피니티"}},[t._v("#")]),t._v(" 어피니티")]),t._v(" "),a("ul",[a("li",[t._v("컨테이너로 서비스를 운영하다 보면 서비스 A의 파드와 서비스 B의 파드 사이에 자주 통신할 때가 있는데, 이때 이 두 파드를 같은 노드에 속하게 만들어 효율을 높임")]),t._v(" "),a("li",[t._v("가장 흔한 예로 데이터베이스나 캐시 같은 서비스와 통신하는 앱 컨테이너를 같은 노드에 두어 네트워크 통신 비용을 줄이는 것")])]),t._v(" "),a("h4",{attrs:{id:"안티-어피니티"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#안티-어피니티"}},[t._v("#")]),t._v(" 안티 어피니티")]),t._v(" "),a("ul",[a("li",[t._v("CPU나 네트워크 같은 하드웨어 자원을 많이 사용하는 앱 컨테이너가 있을 때 여러 노드로 파드를 분산하는 것")]),t._v(" "),a("li",[t._v("안티 어피니티를 설정하지 않으면 디플로이먼트로 배포한 파드가 노드 하나에서만 실행되어 자원을 많이 소모할 수 있음")])]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" apps/v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Deployment\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" redis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("cache\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("selector")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("matchLabels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("app")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" store\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("replicas")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("template")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("labels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("app")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" store\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("affinity")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("podAntiAffinity")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("requiredDuringSchedulingIgnoredDuringExecution")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("labelSelector")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n              "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("matchExpressions")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n              "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("key")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" app\n                "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("operator")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" In\n                "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("values")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" store "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# app 필드 값이 store인 파드가 속한 노드를 피해서 파드를 추가한다는 설정 \t")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("topologyKey")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"kubernetes.io/hostname"')]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("containers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" redis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("server\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" redis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("3.2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("alpine\n")])])]),a("br"),t._v(" "),a("h2",{attrs:{id:"테인트와-톨러레이션"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#테인트와-톨러레이션"}},[t._v("#")]),t._v(" 테인트와 톨러레이션")]),t._v(" "),a("ul",[a("li",[t._v("쿠버네티스 클러스터의 특정 노드에 테인트를 설정할 수 있는데, 테인트를 설정하면 설정한 노드에는 파드들을 스케줄링하지 않음")]),t._v(" "),a("li",[t._v("테인트를 설정한 노드에 파드들을 스케줄링하기 위해서는 톨러레이션을 설정해야함")]),t._v(" "),a("li",[t._v("테인트는 톨러레이션에서 설정한 특정 파드들만 실행하고 다른 파드는 실행하지 못하게 함")]),t._v(" "),a("li",[a("strong",[t._v("테인트와 톨러레이션은 주로 노드를 특정 역할만 하도록 만들 때 사용")])]),t._v(" "),a("li",[t._v("예를 들어 데이터베이스용 파드를 실행한 후 노드 전체의 CPU나 RAM 자원을 독점해서 사용할 수 있도록 설정하는 것")]),t._v(" "),a("li",[t._v("테인트는 키, 값, 효과의 세 가지로 구성됨. "),a("code",[t._v("kubectl taint nodes {노드이름} {키=값:효과}")])])]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" apps/v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Deployment\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kubernetes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("simple"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("app\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("labels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("app")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kubernetes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("simple"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("app\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("replicas")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("selector")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("matchLabels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("app")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kubernetes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("simple"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("app\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("template")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("labels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("app")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kubernetes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("simple"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("app\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("containers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kubernetes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("simple"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("app\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" arisu1000/simple"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("container"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("latest\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("containerPort")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8080")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("tolerations")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 테인트가 설정된 노드에 실행시키기 위한 톨러레이션 설정")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("key")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"key01"')]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("operator")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Equal"')]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("value")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"value01"')]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("effect")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"NoSchedule"')]),t._v("\n        \t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# NoSchedule: 톨러레이션 설정이 없으면 파드를 스케줄링하지 않음. 기존에 실행되던 파드에는 적용되지 않음")]),t._v("\n        \t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# PreferNoSchedule: 톨러레이션 설정이 없으면 파드를 스케줄링하지 않음. 하지만 자원이 부족하면 스케줄링 가능")]),t._v("\n        \t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# NoExecute: 톨러레이션 설정이 없으면 새로운 파드를 스케줄링하지 않음. 기존 파드도 테인트 설정을 무시할수 있는 톨러레이션 설정이 없으면 종료 ")]),t._v("\n")])])]),a("br"),t._v(" "),a("h2",{attrs:{id:"클러스터를-관리하는-커든과-드레인"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#클러스터를-관리하는-커든과-드레인"}},[t._v("#")]),t._v(" 클러스터를 관리하는 커든과 드레인")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("쿠버네티스를 사용하다 보면 특정 노드에 있는 파드들을 모두 다른 노드로 옮기거나 특정 노드에 파드들을 스케줄링하지 않도록 제한할 필요 존재")])]),t._v(" "),a("li",[a("p",[a("strong",[t._v("커든(cordon):")]),t._v(" 지정된 노드에 추가로 파드를 스케줄링해서 실행하지 않도록 함")])]),t._v(" "),a("li",[a("p",[a("strong",[t._v("드레인(drain)")])]),t._v(" "),a("ul",[a("li",[t._v("노드 관리 등의 이유로 지정된 노드에 있는 파드들을 다른 노드로 이동시키는 명령")]),t._v(" "),a("li",[t._v("노드에 데몬세트로 실행한 파드들이 있으면 데몬세트로 실행한 파드들은 삭제해도 데몬세트가 즉시 재실행시키기 때문에 드레인 설정을 적용할 수 없음")])])])]),t._v(" "),a("br"),t._v(" "),a("h2",{attrs:{id:"referenses"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#referenses"}},[t._v("#")]),t._v(" Referenses")]),t._v(" "),a("ul",[a("li",[t._v("쿠버네티스 입문 - 90가지 예제로 배우는 컨테이너 관리 자동화 표준 / 동양북스")])])],1)}),[],!1,null,null,null);s.default=e.exports}}]);